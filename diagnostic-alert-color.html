<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alert Color Diagnostic</title>
  <style>
    body {
      font-family: 'Monaco', 'Courier New', monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    .section {
      background: #2a2a2a;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      border: 1px solid #444;
    }
    h2 {
      color: #4da6ff;
      margin-top: 0;
    }
    .code {
      background: #1a1a1a;
      padding: 10px;
      border-radius: 4px;
      border-left: 3px solid #4da6ff;
      overflow-x: auto;
    }
    .error {
      color: #ff6b6b;
    }
    .success {
      color: #51cf66;
    }
    .warning {
      color: #ffd43b;
    }
    button {
      background: #4da6ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    button:hover {
      background: #3b8fd9;
    }
  </style>
</head>
<body>
  <h1>üîç Alert Color Diagnostic</h1>
  <p>This tool helps diagnose why Alert text shows gray instead of proper color.</p>
  
  <div class="section">
    <h2>Step 1: Find Sandbox Iframe</h2>
    <button onclick="findIframe()">Find Iframe</button>
    <div class="code" id="iframe-result">Click the button to search...</div>
  </div>
  
  <div class="section">
    <h2>Step 2: Inspect Alert Element</h2>
    <button onclick="inspectAlert()">Inspect Alert</button>
    <div class="code" id="alert-result">Find iframe first...</div>
  </div>
  
  <div class="section">
    <h2>Step 3: Check CSS Variables</h2>
    <button onclick="checkCSSVars()">Check CSS Variables</button>
    <div class="code" id="vars-result">Find iframe first...</div>
  </div>
  
  <div class="section">
    <h2>Step 4: Compare Themes</h2>
    <button onclick="compareThemes()">Compare Light vs Dark</button>
    <div class="code" id="theme-result">Find iframe first...</div>
  </div>

  <script>
    let sandboxIframe = null;
    let sandboxDoc = null;
    
    function log(elementId, message, type = 'info') {
      const el = document.getElementById(elementId);
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
      const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : 'üìã';
      el.innerHTML += `<div class="${className}">${icon} ${message}</div>`;
    }
    
    function clearLog(elementId) {
      document.getElementById(elementId).innerHTML = '';
    }
    
    function findIframe() {
      clearLog('iframe-result');
      log('iframe-result', 'Searching for sandbox iframe...');
      
      // Look for iframe in current document
      const iframes = document.querySelectorAll('iframe');
      log('iframe-result', `Found ${iframes.length} iframe(s) in current document`);
      
      // Check each iframe
      iframes.forEach((iframe, index) => {
        try {
          const src = iframe.src || 'no src';
          const id = iframe.id || 'no id';
          log('iframe-result', `Iframe ${index}: src="${src}", id="${id}"`);
          
          // Try to access iframe content (will fail if cross-origin)
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          if (doc) {
            sandboxIframe = iframe;
            sandboxDoc = doc;
            log('iframe-result', `‚úÖ Can access iframe ${index} content`, 'success');
            
            // Check if it has the sandbox structure
            const root = doc.getElementById('root');
            if (root) {
              log('iframe-result', '‚úÖ Found #root element in iframe', 'success');
            }
          }
        } catch (e) {
          log('iframe-result', `Cannot access iframe ${index}: ${e.message}`, 'error');
        }
      });
      
      if (!sandboxIframe) {
        log('iframe-result', '‚ùå No accessible sandbox iframe found', 'error');
        log('iframe-result', 'This diagnostic must be run inside the app or opened in a tab where the main app is accessible', 'warning');
      }
    }
    
    function inspectAlert() {
      clearLog('alert-result');
      
      if (!sandboxDoc) {
        log('alert-result', 'No sandbox document. Find iframe first.', 'error');
        return;
      }
      
      log('alert-result', 'Looking for Alert component...');
      
      // Look for Alert by class name (Aksel uses namespaced classes)
      const alertElements = sandboxDoc.querySelectorAll('[class*="alert"]');
      log('alert-result', `Found ${alertElements.length} elements with "alert" in class name`);
      
      alertElements.forEach((alert, index) => {
        const classes = alert.className;
        const computedStyle = window.getComputedStyle(alert);
        
        log('alert-result', `\nAlert ${index}:`);
        log('alert-result', `Classes: ${classes}`);
        log('alert-result', `Tag: ${alert.tagName}`);
        log('alert-result', `Color: ${computedStyle.color}`);
        log('alert-result', `Background: ${computedStyle.backgroundColor}`);
        log('alert-result', `Text from element: "${alert.textContent?.substring(0, 50)}..."`);
        
        // Check if this is an info alert
        if (classes.includes('info') || classes.includes('Alert')) {
          log('alert-result', 'üëÜ This looks like the Alert component', 'success');
          
          // Check the actual text elements inside
          const textElements = alert.querySelectorAll('*');
          log('alert-result', `\nChecking ${textElements.length} child elements:`);
          
          textElements.forEach((child, childIndex) => {
            const childStyle = window.getComputedStyle(child);
            const childColor = childStyle.color;
            const childText = child.textContent?.substring(0, 30);
            
            if (childText && childText.trim() && child.children.length === 0) {
              log('alert-result', `Child ${childIndex} (${child.tagName}): color=${childColor}, text="${childText}..."`);
            }
          });
        }
      });
    }
    
    function checkCSSVars() {
      clearLog('vars-result');
      
      if (!sandboxDoc) {
        log('vars-result', 'No sandbox document. Find iframe first.', 'error');
        return;
      }
      
      log('vars-result', 'Checking CSS Variables on root element...');
      
      const root = sandboxDoc.documentElement;
      const rootStyles = window.getComputedStyle(root);
      
      // Check theme classes
      log('vars-result', `\nHTML classes: ${root.className}`);
      log('vars-result', `HTML data-color: ${root.getAttribute('data-color')}`);
      log('vars-result', `HTML color-scheme: ${rootStyles.colorScheme}`);
      
      // Check #root
      const rootEl = sandboxDoc.getElementById('root');
      if (rootEl) {
        const rootElStyles = window.getComputedStyle(rootEl);
        log('vars-result', `\n#root classes: ${rootEl.className}`);
        log('vars-result', `#root color-scheme: ${rootElStyles.colorScheme}`);
      }
      
      // Check key CSS variables
      const vars = [
        '--ax-text-neutral',
        '--ax-text-subtle',
        '--ax-bg-default',
        '--ax-bg-sunken',
        '--a-text-default',
        '--a-text-subtle'
      ];
      
      log('vars-result', '\nCSS Variables on <html>:');
      vars.forEach(varName => {
        const value = rootStyles.getPropertyValue(varName);
        if (value && value.trim()) {
          log('vars-result', `${varName}: ${value.trim()}`, 'success');
        } else {
          log('vars-result', `${varName}: NOT DEFINED`, 'error');
        }
      });
      
      // Check on root element
      if (rootEl) {
        const rootElStyles = window.getComputedStyle(rootEl);
        log('vars-result', '\nCSS Variables on #root:');
        vars.forEach(varName => {
          const value = rootElStyles.getPropertyValue(varName);
          if (value && value.trim()) {
            log('vars-result', `${varName}: ${value.trim()}`, 'success');
          } else {
            log('vars-result', `${varName}: NOT DEFINED`, 'error');
          }
        });
      }
    }
    
    function compareThemes() {
      clearLog('theme-result');
      
      if (!sandboxDoc) {
        log('theme-result', 'No sandbox document. Find iframe first.', 'error');
        return;
      }
      
      log('theme-result', 'Comparing CSS variable values in light vs dark theme...');
      log('theme-result', 'This requires temporarily changing theme. Not implemented yet.', 'warning');
      log('theme-result', '\nCurrent theme state:', 'warning');
      
      const root = sandboxDoc.documentElement;
      const isDark = root.className.includes('dark');
      const isLight = root.className.includes('light');
      
      log('theme-result', `Has "dark" class: ${isDark}`);
      log('theme-result', `Has "light" class: ${isLight}`);
      
      const rootStyles = window.getComputedStyle(root);
      const textNeutral = rootStyles.getPropertyValue('--ax-text-neutral').trim();
      
      log('theme-result', `\nCurrent --ax-text-neutral: ${textNeutral}`);
      log('theme-result', '\nüí° To compare themes: Use the theme toggle in the app and re-run this check', 'warning');
    }
  </script>
  
  <div class="section">
    <h2>üìñ Manual Inspection Instructions</h2>
    <div class="code">
If automated detection fails, manually inspect:
1. Open http://localhost:5173 in browser
2. Open DevTools (F12)
3. Find the preview iframe in Elements tab
4. Inside iframe, find the Alert element
5. In Computed tab, search for "color"
6. Check what value --ax-text-neutral resolves to
7. Compare in light mode vs dark mode
    </div>
  </div>
</body>
</html>
