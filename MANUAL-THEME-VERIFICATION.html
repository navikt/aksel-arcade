<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manual Theme Verification</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 { margin-bottom: 2rem; }
    .test-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .test-section {
      border: 2px solid #333;
      padding: 1.5rem;
      border-radius: 8px;
    }
    h2 {
      margin-top: 0;
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      background: white;
      margin-top: 1rem;
    }
    .console {
      margin-top: 1rem;
      padding: 1rem;
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 4px;
      font-family: 'Monaco', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .log { color: #4ec9b0; }
    .error { color: #f48771; }
    .success { color: #89d185; }
    button {
      margin: 0.5rem 0.5rem 0.5rem 0;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 14px;
    }
    .info {
      padding: 1rem;
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 4px;
      margin-bottom: 1rem;
    }
    .checklist {
      margin-top: 1rem;
      padding: 1rem;
      background: #e8f4ff;
      border-radius: 4px;
    }
    .checklist div {
      margin: 0.5rem 0;
      font-family: monospace;
    }
    .check-pass { color: green; }
    .check-fail { color: red; }
  </style>
</head>
<body>
  <h1>üß™ Manual Theme Wrapper Verification</h1>
  
  <div class="info">
    <strong>Instructions:</strong> This page will test if Aksel components render correctly with Theme wrapper.
    <br>After loading, click "Run All Checks" to verify.
  </div>

  <div class="test-grid">
    <div class="test-section">
      <h2>üéØ Sandbox with Theme</h2>
      <iframe id="sandbox" src="/sandbox.html"></iframe>
      <button onclick="testButton()">1. Test Button</button>
      <button onclick="testMultiple()">2. Test Multiple Components</button>
      <button onclick="clearSandbox()">Clear</button>
      <button onclick="runAllChecks()" style="background: #4caf50; color: white; font-weight: bold;">Run All Checks</button>
      <div class="console" id="console"></div>
      <div class="checklist" id="checklist" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>üìä Expected vs Actual</h2>
      <div id="comparison"></div>
    </div>
  </div>

  <script>
    const consoleDiv = document.getElementById('console');
    const checklistDiv = document.getElementById('checklist');
    const comparisonDiv = document.getElementById('comparison');
    const sandbox = document.getElementById('sandbox');
    
    let checks = [];

    function log(msg, type = 'log') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      consoleDiv.appendChild(div);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    function addCheck(description, passed, details = '') {
      checks.push({ description, passed, details });
      updateChecklist();
    }

    function updateChecklist() {
      checklistDiv.style.display = 'block';
      checklistDiv.innerHTML = '<strong>Verification Results:</strong><br><br>';
      
      checks.forEach(check => {
        const div = document.createElement('div');
        div.className = check.passed ? 'check-pass' : 'check-fail';
        div.innerHTML = `${check.passed ? '‚úÖ' : '‚ùå'} ${check.description}`;
        if (check.details) {
          div.innerHTML += `<br>&nbsp;&nbsp;&nbsp;&nbsp;<small>${check.details}</small>`;
        }
        checklistDiv.appendChild(div);
      });

      // Summary
      const passed = checks.filter(c => c.passed).length;
      const total = checks.length;
      const summaryDiv = document.createElement('div');
      summaryDiv.style.marginTop = '1rem';
      summaryDiv.style.fontWeight = 'bold';
      summaryDiv.innerHTML = `<br>Summary: ${passed}/${total} checks passed`;
      summaryDiv.className = passed === total ? 'check-pass' : 'check-fail';
      checklistDiv.appendChild(summaryDiv);
    }

    window.addEventListener('message', (event) => {
      if (!event.data?.type) return;
      
      const msg = event.data;
      
      if (msg.type === 'SANDBOX_READY') {
        log('‚úÖ Sandbox ready', 'success');
        addCheck('Sandbox loads successfully', true);
      } else if (msg.type === 'RENDER_SUCCESS') {
        log('‚úÖ Render successful', 'success');
        setTimeout(() => inspectDOM(), 500);
      } else if (msg.type === 'RUNTIME_ERROR') {
        log(`‚ùå Error: ${msg.payload.message}`, 'error');
        addCheck('Code executes without errors', false, msg.payload.message);
      } else if (msg.type === 'CONSOLE_LOG') {
        const args = msg.payload.args.join(' ');
        log(`Console: ${args}`, msg.payload.level);
      }
    });

    function testButton() {
      checks = [];
      log('üì§ Sending Button test...', 'log');
      
      const code = `function App() {
  return <Button variant="primary">Test Button</Button>;
}`;
      
      sandbox.contentWindow.postMessage({
        type: 'EXECUTE_CODE',
        payload: { jsxCode: code }
      }, '*');
    }

    function testMultiple() {
      checks = [];
      log('üì§ Sending multiple components test...', 'log');
      
      const code = `function App() {
  return (
    <div>
      <Heading size="large">Test Heading</Heading>
      <Button variant="primary">Primary</Button>
      <Button variant="secondary">Secondary</Button>
    </div>
  );
}`;
      
      sandbox.contentWindow.postMessage({
        type: 'EXECUTE_CODE',
        payload: { jsxCode: code }
      }, '*');
    }

    function clearSandbox() {
      checks = [];
      checklistDiv.style.display = 'none';
      log('üßπ Clearing...', 'log');
      sandbox.contentWindow.postMessage({
        type: 'EXECUTE_CODE',
        payload: { jsxCode: '' }
      }, '*');
    }

    function inspectDOM() {
      try {
        const doc = sandbox.contentDocument || sandbox.contentWindow.document;
        const root = doc.getElementById('root');
        
        if (!root) {
          addCheck('Root element exists', false);
          log('‚ùå No root element', 'error');
          return;
        }
        
        addCheck('Root element exists', true);
        log('‚úÖ Root found', 'success');

        // Check for Theme wrapper
        const themeDiv = root.querySelector('.aksel-theme');
        if (themeDiv) {
          addCheck('Theme wrapper (.aksel-theme) present', true, `Classes: ${themeDiv.className}`);
          log(`‚úÖ Theme wrapper found: ${themeDiv.className}`, 'success');
        } else {
          addCheck('Theme wrapper (.aksel-theme) present', false, 'Not found in DOM');
          log('‚ùå No Theme wrapper', 'error');
        }

        // Check for button
        const button = root.querySelector('button');
        if (button) {
          addCheck('Button element renders', true);
          log(`‚úÖ Button found: "${button.textContent}"`, 'success');
          
          // Check for Aksel class
          if (button.classList.contains('navds-button')) {
            addCheck('Button has navds-button class', true, button.className);
            log(`‚úÖ Button has correct class: ${button.className}`, 'success');
          } else {
            addCheck('Button has navds-button class', false, `Found: ${button.className}`);
            log(`‚ùå Button missing navds-button: ${button.className}`, 'error');
          }

          // Check styles
          const styles = sandbox.contentWindow.getComputedStyle(button);
          const bgColor = styles.backgroundColor;
          const padding = styles.padding;
          const borderRadius = styles.borderRadius;
          
          log(`   Background: ${bgColor}`, 'log');
          log(`   Padding: ${padding}`, 'log');
          log(`   Border-radius: ${borderRadius}`, 'log');

          // Aksel buttons should have a solid background color
          const hasBackground = bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent';
          addCheck('Button has styled background', hasBackground, `Background: ${bgColor}`);

          // Update comparison
          comparisonDiv.innerHTML = `
            <h3>Button Inspection:</h3>
            <table style="width: 100%; font-size: 14px;">
              <tr><td><strong>Text:</strong></td><td>${button.textContent}</td></tr>
              <tr><td><strong>Classes:</strong></td><td>${button.className || '(none)'}</td></tr>
              <tr><td><strong>Background:</strong></td><td>${bgColor}</td></tr>
              <tr><td><strong>Padding:</strong></td><td>${padding}</td></tr>
              <tr><td><strong>Border-radius:</strong></td><td>${borderRadius}</td></tr>
            </table>
          `;
        } else {
          addCheck('Button element renders', false);
          log('‚ùå No button found', 'error');
        }

        // Check for heading
        const heading = root.querySelector('h1, h2, h3, h4, h5, h6');
        if (heading) {
          addCheck('Heading element renders', true);
          const hasClass = heading.classList.contains('navds-heading');
          addCheck('Heading has navds-heading class', hasClass, heading.className);
          log(`${hasClass ? '‚úÖ' : '‚ùå'} Heading: ${heading.className}`, hasClass ? 'success' : 'error');
        }

      } catch (err) {
        addCheck('DOM inspection completes', false, err.message);
        log(`‚ùå Inspection error: ${err.message}`, 'error');
      }
    }

    function runAllChecks() {
      log('üöÄ Running all checks...', 'success');
      testButton();
    }

    // Auto-run on load
    setTimeout(() => {
      log('üîÑ Auto-running initial check...', 'log');
      runAllChecks();
    }, 2000);
  </script>
</body>
</html>
