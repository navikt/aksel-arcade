<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Theme Wrapper</title>
  <style>
    body {
      padding: 2rem;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    h1 { margin-bottom: 1rem; }
    .test-section {
      margin: 2rem 0;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .test-section h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    .status {
      padding: 0.5rem;
      margin: 1rem 0;
      border-radius: 4px;
      font-weight: bold;
    }
    .status.success { background: #e6ffe6; color: #006600; }
    .status.error { background: #ffe6e6; color: #cc0000; }
    .status.info { background: #e6f3ff; color: #0066cc; }
    iframe {
      width: 100%;
      height: 200px;
      border: 1px solid #999;
      border-radius: 4px;
      margin-top: 1rem;
    }
    .console-log {
      background: #f5f5f5;
      border: 1px solid #ddd;
      padding: 1rem;
      margin-top: 1rem;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 0.25rem 0;
      padding: 0.25rem;
    }
    .log-entry.error { color: red; }
    .log-entry.warn { color: orange; }
    .log-entry.info { color: blue; }
  </style>
</head>
<body>
  <h1>üß™ Theme Wrapper Test</h1>
  <p>This test verifies that Aksel components render with proper Darkside styling via Theme wrapper.</p>

  <div class="test-section">
    <h2>Test 1: Load Sandbox with Theme</h2>
    <div id="status-load" class="status info">Loading sandbox...</div>
    <iframe id="sandbox-frame" src="/sandbox.html"></iframe>
  </div>

  <div class="test-section">
    <h2>Test 2: Render Button Component</h2>
    <div id="status-render" class="status info">Waiting for sandbox...</div>
    <button onclick="renderButton()">Render Button</button>
  </div>

  <div class="test-section">
    <h2>Test 3: Check Button Styling</h2>
    <div id="status-style" class="status info">Waiting for render...</div>
    <div id="style-details"></div>
  </div>

  <div class="test-section">
    <h2>Console Output</h2>
    <div id="console-log" class="console-log"></div>
  </div>

  <script>
    const sandboxFrame = document.getElementById('sandbox-frame');
    const consoleLog = document.getElementById('console-log');
    let sandboxReady = false;

    // Listen for messages from sandbox
    window.addEventListener('message', (event) => {
      if (!event.data || typeof event.data !== 'object') return;

      const { type, payload } = event.data;
      
      console.log('üì• Received message:', type, payload);
      logToConsole('info', `Received: ${type}`);

      switch (type) {
        case 'SANDBOX_READY':
          sandboxReady = true;
          document.getElementById('status-load').className = 'status success';
          document.getElementById('status-load').textContent = '‚úÖ Sandbox loaded successfully';
          document.getElementById('status-render').className = 'status info';
          document.getElementById('status-render').textContent = 'Ready to render. Click the button above.';
          break;

        case 'RENDER_SUCCESS':
          document.getElementById('status-render').className = 'status success';
          document.getElementById('status-render').textContent = '‚úÖ Component rendered successfully';
          // Check styling after a short delay
          setTimeout(checkButtonStyling, 500);
          break;

        case 'RUNTIME_ERROR':
          document.getElementById('status-render').className = 'status error';
          document.getElementById('status-render').textContent = `‚ùå Runtime Error: ${payload.message}`;
          logToConsole('error', `Error: ${payload.message}`);
          break;

        case 'CONSOLE_LOG':
          logToConsole(payload.level, payload.args.join(' '));
          break;
      }
    });

    function logToConsole(level, message) {
      const entry = document.createElement('div');
      entry.className = `log-entry ${level}`;
      entry.textContent = `[${level.toUpperCase()}] ${message}`;
      consoleLog.appendChild(entry);
      consoleLog.scrollTop = consoleLog.scrollHeight;
    }

    function renderButton() {
      if (!sandboxReady) {
        alert('Sandbox not ready yet. Please wait...');
        return;
      }

      const code = `
export default function App() {
  return (
    <div style={{ padding: '20px' }}>
      <Button variant="primary">Test Button</Button>
    </div>
  );
}
      `.trim();

      sandboxFrame.contentWindow.postMessage({
        type: 'EXECUTE_CODE',
        payload: { jsxCode: code }
      }, '*');

      logToConsole('info', 'Sent EXECUTE_CODE message');
    }

    function checkButtonStyling() {
      try {
        const sandboxDoc = sandboxFrame.contentWindow.document;
        const button = sandboxDoc.querySelector('button');

        if (!button) {
          document.getElementById('status-style').className = 'status error';
          document.getElementById('status-style').textContent = '‚ùå Button not found in DOM';
          return;
        }

        const styles = sandboxFrame.contentWindow.getComputedStyle(button);
        const bg = styles.backgroundColor;
        const color = styles.color;
        const classes = button.className;

        const detailsHtml = `
          <p><strong>Classes:</strong> ${classes}</p>
          <p><strong>Background:</strong> ${bg}</p>
          <p><strong>Color:</strong> ${color}</p>
        `;
        document.getElementById('style-details').innerHTML = detailsHtml;

        // Check if it's the expected Aksel Darkside blue (rgb(33, 118, 212))
        if (bg.includes('33, 118, 212') || bg.includes('#2176d4')) {
          document.getElementById('status-style').className = 'status success';
          document.getElementById('status-style').textContent = '‚úÖ Button has correct Aksel Darkside styling!';
          logToConsole('info', '‚úÖ SUCCESS: Button styled correctly');
        } else {
          document.getElementById('status-style').className = 'status error';
          document.getElementById('status-style').textContent = `‚ùå Button background is ${bg}, expected rgb(33, 118, 212) or similar blue`;
          logToConsole('error', `‚ùå FAIL: Wrong background color: ${bg}`);
        }
      } catch (error) {
        document.getElementById('status-style').className = 'status error';
        document.getElementById('status-style').textContent = `‚ùå Error checking styles: ${error.message}`;
        logToConsole('error', `Error: ${error.message}`);
      }
    }

    // Auto-render button after sandbox loads
    window.addEventListener('message', (event) => {
      if (event.data?.type === 'SANDBOX_READY') {
        setTimeout(() => {
          renderButton();
        }, 500);
      }
    });
  </script>
</body>
</html>
